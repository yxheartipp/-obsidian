---
alias: []
Type: 
tags: ["#review"]
sr-due: 2024-04-25
sr-interval: 1
sr-ease: 250
---

## 4线程 八百万数据量，后台4工作组，subcompaction1 

- sudo ./db_bench --benchmarks=fillseq --use_existing_db=0 --dev=/dev/nvme0n2 --num=8000000 --fs_uri=bluefs_rpc:///dev/nvme0n2//mount/host --compression_type=none --db=db --level0_file_num_compaction_trigger=4 --allow_concurrent_memtable_write=false --level0_slowdown_writes_trigger=20 --level0_stop_writes_trigger=30 --max_background_jobs=4 --max_write_buffer_number=2 --num_levels=6 --subcompactions=1 --statistics=0 --value_size=4096 --key_size=20 --stats_per_interval=1 --stats_interval_seconds=5 --report_interval_seconds=5 --report_file=./fillseq_8000000_threads_4:11:40.csv --threads=4
![[Pasted image 20240424115334.png]]
cpu基本没有毛刺，其qps报告也基本维持了一个直线。
![[Pasted image 20240424115424.png]]
对于ssd的写入速度微微触发了毛刺和cpu基本处于平齐，cpu运算高时没有触发到毛刺。
在rocksdb的status信息中也可以看到没有触发stall。


## 8线程 八百万数据量，后台4工作组，subcompaction1 
- sudo ./db_bench --benchmarks=fillseq --use_existing_db=0 --dev=/dev/nvme0n2 --num=8000000 --fs_uri=bluefs_rpc:///dev/nvme0n2//mount/host --compression_type=none --db=db --level0_file_num_compaction_trigger=4 --allow_concurrent_memtable_write=false --level0_slowdown_writes_trigger=20 --level0_stop_writes_trigger=30 --max_background_jobs=8 --max_write_buffer_number=2 --num_levels=6 --subcompactions=1 --statistics=0 --value_size=4096 --key_size=20 --stats_per_interval=1 --stats_interval_seconds=5 --report_interval_seconds=5 --report_file=./fillseq_8000000_threads_8:11:40.csv --threads=8

** File Read Latency Histogram By Level [default] **

** DB Stats **
Uptime(secs): 864.3 total, 5.1 interval
Cumulative writes: 63M writes, 63M keys, 15M commit groups, 4.0 writes per commit group, ingest: 244.71 GB, 289.92 MB/s
Cumulative WAL: 63M writes, 0 syncs, 63729267.00 writes per sync, written: 244.71 GB, 289.92 MB/s
Cumulative stall: 00:00:0.000 H:M:S, 0.0 percent
Interval writes: 360K writes, 360K keys, 89K commit groups, 4.0 writes per commit group, ingest: 1418.10 MB, 278.89 MB/s
Interval WAL: 360K writes, 0 syncs, 360662.00 writes per sync, written: 1.38 GB, 278.90 MB/s
Interval stall: 00:00:0.000 H:M:S, 0.0 percent
Write Stall (count): write-buffer-manager-limit-stops: 0
num-running-compactions: 1
num-running-flushes: 0

2024/04/24-12:13:12  ... thread 6: (45000,7967000) ops and (8853.3,9217.5) ops/second in (5.082827,864.329653) seconds
2024/04/24-12:13:12  ... thread 2: (45000,7966000) ops and (8866.6,9216.3) ops/second in (5.075245,864.334614) seconds
fillseq      :     108.507 micros/op 73720 ops/sec 868.141 seconds 64000000 operations;  289.4 MB/s
